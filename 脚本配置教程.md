# PyMacroLite 脚本配置教程

这是一份面向零基础用户的详细教程，教你如何编写自动化脚本。

---

## 目录

1. [什么是脚本](#什么是脚本)
2. [脚本文件结构](#脚本文件结构)
3. [基础指令详解](#基础指令详解)
4. [实战案例](#实战案例)
5. [常见问题](#常见问题)

---

## 什么是脚本

脚本就是一份"操作清单"，告诉电脑按顺序执行哪些操作。

比如你想让电脑自动登录游戏，脚本就是：
```
1. 点击账号输入框
2. 输入账号
3. 点击密码输入框
4. 输入密码
5. 点击登录按钮
```

我们把这些步骤写成电脑能理解的格式（JSON），软件就能自动执行了。

---

## 脚本文件结构

脚本是一个 `.json` 文件，用记事本就能编辑。

### 最简单的脚本

```json
{
    "main": [
        {"action": "click", "params": {"x": 100, "y": 200}}
    ]
}
```

这个脚本只做一件事：点击屏幕坐标 (100, 200) 的位置。

### 结构说明

```json
{
    "_settings": {
        这里写全局设置
    },
    "main": [
        这里写主要步骤
    ],
    "其他模块名": [
        这里写其他步骤
    ]
}
```

- `_settings`：全局设置（可选）
- `main`：主模块，程序默认从这里开始执行
- 其他模块：可以被调用的子流程

### 全局设置说明

```json
"_settings": {
    "global_variance": 5,
    "global_offset_x": 0,
    "global_offset_y": 0,
    "human_move": true
}
```

| 设置 | 含义 | 建议值 |
|------|------|--------|
| global_variance | 随机误差（像素），让点击位置有轻微偏移，更像人类操作 | 3~8 |
| global_offset_x | X轴偏移，所有坐标都会加上这个值 | 0 |
| global_offset_y | Y轴偏移，所有坐标都会加上这个值 | 0 |
| human_move | 是否启用拟人化鼠标移动（曲线移动而非瞬移） | true |

---

## 基础指令详解

每个指令的格式都是：
```json
{"action": "指令名称", "params": {参数}}
```

### 1. 等待 (wait)

让程序暂停一段时间。

```json
{"action": "wait", "params": {"seconds": 2}}
```

- `seconds`：等待秒数，支持小数如 0.5

**什么时候用？**
- 点击按钮后等待界面加载
- 两个操作之间需要间隔

**例子：点击后等待2秒**
```json
{"action": "click", "params": {"x": 100, "y": 200}},
{"action": "wait", "params": {"seconds": 2}}
```

---

### 2. 点击 (click)

点击屏幕上的某个位置。

```json
{"action": "click", "params": {"x": 100, "y": 200}}
```

**完整参数：**
```json
{"action": "click", "params": {
    "x": 100,
    "y": 200,
    "button": "left",
    "human": true
}}
```

| 参数 | 含义 | 可选值 |
|------|------|--------|
| x | 横坐标 | 数字 |
| y | 纵坐标 | 数字 |
| button | 鼠标按键 | "left"(左键), "right"(右键), "middle"(中键) |
| human | 拟人化移动 | true/false |

**如何获取坐标？**
1. 打开软件，连接目标窗口
2. 截图测试
3. 用画图软件打开截图，鼠标移动到目标位置查看坐标

**例子：右键点击**
```json
{"action": "click", "params": {"x": 300, "y": 400, "button": "right"}}
```

---

### 3. 双击 (double_click)

双击屏幕上的某个位置。

```json
{"action": "double_click", "params": {"x": 100, "y": 200}}
```

---

### 4. 拖拽 (drag)

从一个位置拖动到另一个位置。

```json
{"action": "drag", "params": {
    "x1": 100,
    "y1": 200,
    "x2": 300,
    "y2": 400,
    "duration": 0.5
}}
```

| 参数 | 含义 |
|------|------|
| x1, y1 | 起点坐标 |
| x2, y2 | 终点坐标 |
| duration | 拖动时长（秒） |

**例子：拖动物品**
```json
{"action": "drag", "params": {"x1": 100, "y1": 100, "x2": 200, "y2": 200, "duration": 0.3}}
```

---

### 5. 滚轮 (scroll)

滚动鼠标滚轮。

```json
{"action": "scroll", "params": {"steps": 3}}
```

- `steps`：正数向上滚，负数向下滚

**例子：向下滚动5格**
```json
{"action": "scroll", "params": {"steps": -5}}
```

---

### 6. 输入文字 (type)

输入一段文字（仅支持英文和数字）。

```json
{"action": "type", "params": {"text": "hello123"}}
```

**注意：** 不支持中文输入，中文请用复制粘贴。

---

### 7. 按键 (key_hold)

按住某个键一段时间。

```json
{"action": "key_hold", "params": {"key": "w", "duration": 1.0}}
```

| 参数 | 含义 |
|------|------|
| key | 按键名称 |
| duration | 按住时长（秒） |

**常用按键名称：**
- 字母：a, b, c, ... z
- 数字：1, 2, 3, ... 0
- 功能键：f1, f2, ... f12
- 特殊键：enter, tab, space, esc, shift, ctrl, alt
- 方向键：up, down, left, right

**例子：按住W键走路2秒**
```json
{"action": "key_hold", "params": {"key": "w", "duration": 2.0}}
```

---

### 8. 组合键 (key_combo)

同时按多个键。

```json
{"action": "key_combo", "params": {"keys": "ctrl+c"}}
```

**例子：**
- 复制：`"keys": "ctrl+c"`
- 粘贴：`"keys": "ctrl+v"`
- 全选：`"keys": "ctrl+a"`

---

### 9. 找图并点击 (find_and_click)

在屏幕上找到某张图片，然后点击它。

```json
{"action": "find_and_click", "params": {
    "target": "assets/button.png",
    "confidence": 0.8
}}
```

| 参数 | 含义 | 说明 |
|------|------|------|
| target | 图片路径 | 相对于脚本文件的路径 |
| confidence | 匹配度 | 0~1，越高越严格，建议0.7~0.9 |
| button | 点击按键 | "left", "right", "double" |
| offset_x | X偏移 | 点击位置相对图片中心的偏移 |
| offset_y | Y偏移 | 点击位置相对图片中心的偏移 |
| human | 拟人化 | true/false |

**如何准备图片？**
1. 截取游戏画面
2. 用画图软件裁剪出你要找的按钮/图标
3. 保存为 PNG 格式到 assets 文件夹

**例子：找到登录按钮并点击**
```json
{"action": "find_and_click", "params": {
    "target": "assets/login.png",
    "confidence": 0.8,
    "human": true
}}
```

---

### 10. 找文字并点击 (click_text)

在屏幕上找到某段文字，然后点击它。

```json
{"action": "click_text", "params": {
    "text": "确定",
    "button": "left"
}}
```

| 参数 | 含义 |
|------|------|
| text | 要找的文字 |
| index | 第几个匹配（从1开始） |
| button | 点击按键 |
| offset_x | X偏移 |
| offset_y | Y偏移 |
| region | 搜索区域 [x, y, 宽, 高] |

**例子：点击第2个"购买"按钮**
```json
{"action": "click_text", "params": {"text": "购买", "index": 2}}
```

**例子：在指定区域找文字**
```json
{"action": "click_text", "params": {
    "text": "确定",
    "region": [100, 200, 300, 100]
}}
```

---

### 11. 标签 (label)

给某个位置起个名字，方便跳转。

```json
{"action": "label", "params": {"name": "开始"}}
```

标签本身不执行任何操作，只是一个标记。

---

### 12. 跳转 (jump)

跳转到某个标签位置继续执行。

```json
{"action": "jump", "params": {"target": "开始"}}
```

**例子：无限循环**
```json
{"action": "label", "params": {"name": "循环开始"}},
{"action": "click", "params": {"x": 100, "y": 200}},
{"action": "wait", "params": {"seconds": 1}},
{"action": "jump", "params": {"target": "循环开始"}}
```

这个脚本会不断重复：点击 → 等待 → 点击 → 等待...

---

### 13. 条件跳转 - 找到就跳转 (jump_if_found)

如果找到某个图片或文字，就跳转到指定标签。

**找图片：**
```json
{"action": "jump_if_found", "params": {
    "target": "assets/monster.png",
    "type": "image",
    "confidence": 0.8,
    "label": "发现怪物"
}}
```

**找文字：**
```json
{"action": "jump_if_found", "params": {
    "target": "背包已满",
    "type": "text",
    "label": "去卖东西"
}}
```

| 参数 | 含义 |
|------|------|
| target | 图片路径或文字内容 |
| type | "image"(图片) 或 "text"(文字) |
| confidence | 匹配度（图片用） |
| label | 找到后跳转到哪个标签 |
| region | 搜索区域 |

---

### 14. 条件跳转 - 数值判断 (check_value_jump)

识别屏幕上的数字，根据数值大小决定是否跳转。

```json
{"action": "check_value_jump", "params": {
    "region": [100, 50, 60, 20],
    "op": "<",
    "value": 30,
    "label": "血量过低"
}}
```

| 参数 | 含义 |
|------|------|
| region | 数字所在区域 [x, y, 宽, 高] |
| op | 比较方式 |
| value | 比较的数值 |
| label | 条件成立时跳转到哪 |

**比较方式 (op)：**
- `">"` 大于
- `"<"` 小于
- `">="` 大于等于
- `"<="` 小于等于
- `"=="` 等于
- `"!="` 不等于

**例子：血量低于30%就吃药**
```json
{"action": "check_value_jump", "params": {
    "region": [50, 100, 40, 15],
    "op": "<",
    "value": 30,
    "label": "吃药"
}},
{"action": "jump", "params": {"target": "继续战斗"}},

{"action": "label", "params": {"name": "吃药"}},
{"action": "key_hold", "params": {"key": "1", "duration": 0.1}},

{"action": "label", "params": {"name": "继续战斗"}}
```

---

### 15. 调用其他模块 (call_script)

执行另一个模块的内容，执行完后返回继续。

```json
{"action": "call_script", "params": {"name": "补血"}}
```

**例子：**
```json
{
    "main": [
        {"action": "call_script", "params": {"name": "登录"}},
        {"action": "call_script", "params": {"name": "开始挂机"}}
    ],
    "登录": [
        登录的步骤...
    ],
    "开始挂机": [
        挂机的步骤...
    ]
}
```

---

### 16. 返回 (return)

从当前模块返回到调用它的地方。

```json
{"action": "return", "params": {}}
```

---

### 17. 退出 (exit)

结束整个脚本。

```json
{"action": "exit", "params": {}}
```

---

## 实战案例

### 案例1：自动登录

```json
{
    "_settings": {
        "global_variance": 5,
        "human_move": true
    },
    "main": [
        {"action": "wait", "params": {"seconds": 2}},
        
        {"action": "find_and_click", "params": {
            "target": "assets/id.png",
            "confidence": 0.8
        }},
        {"action": "wait", "params": {"seconds": 0.3}},
        {"action": "type", "params": {"text": "myusername"}},
        
        {"action": "key_hold", "params": {"key": "tab", "duration": 0.1}},
        {"action": "type", "params": {"text": "mypassword"}},
        
        {"action": "find_and_click", "params": {
            "target": "assets/login.png",
            "confidence": 0.8
        }}
    ]
}
```

**步骤解释：**
1. 等待2秒（等界面加载）
2. 找到账号输入框图片并点击
3. 输入账号
4. 按Tab键切换到密码框
5. 输入密码
6. 找到登录按钮并点击

---

### 案例2：自动挂机打怪

```json
{
    "_settings": {
        "global_variance": 5,
        "human_move": true
    },
    "main": [
        {"action": "label", "params": {"name": "挂机循环"}},
        
        {"action": "jump_if_found", "params": {
            "target": "assets/monster.png",
            "type": "image",
            "confidence": 0.7,
            "label": "攻击怪物"
        }},
        
        {"action": "key_hold", "params": {"key": "w", "duration": 0.5}},
        {"action": "jump", "params": {"target": "挂机循环"}},
        
        {"action": "label", "params": {"name": "攻击怪物"}},
        {"action": "find_and_click", "params": {
            "target": "assets/monster.png",
            "confidence": 0.7
        }},
        {"action": "wait", "params": {"seconds": 0.3}},
        {"action": "key_hold", "params": {"key": "1", "duration": 0.1}},
        {"action": "wait", "params": {"seconds": 2}},
        {"action": "jump", "params": {"target": "挂机循环"}}
    ]
}
```

**流程图：**
```
开始
  ↓
找怪物 ──找到──→ 点击怪物 → 按技能 → 等待2秒
  │                                    ↓
  └──没找到──→ 按W走路 ←─────────────────┘
```

---

### 案例3：自动补血

```json
{
    "main": [
        {"action": "label", "params": {"name": "检查血量"}},
        
        {"action": "check_value_jump", "params": {
            "region": [50, 80, 40, 15],
            "op": "<",
            "value": 50,
            "label": "需要补血"
        }},
        
        {"action": "wait", "params": {"seconds": 1}},
        {"action": "jump", "params": {"target": "检查血量"}},
        
        {"action": "label", "params": {"name": "需要补血"}},
        {"action": "key_hold", "params": {"key": "1", "duration": 0.1}},
        {"action": "wait", "params": {"seconds": 0.5}},
        {"action": "jump", "params": {"target": "检查血量"}}
    ]
}
```

---

### 案例4：处理弹窗

```json
{
    "main": [
        {"action": "label", "params": {"name": "主循环"}},
        
        {"action": "call_script", "params": {"name": "检查弹窗"}},
        
        {"action": "wait", "params": {"seconds": 1}},
        {"action": "jump", "params": {"target": "主循环"}}
    ],
    
    "检查弹窗": [
        {"action": "jump_if_found", "params": {
            "target": "确定",
            "type": "text",
            "label": "点击确定"
        }},
        {"action": "jump_if_found", "params": {
            "target": "取消",
            "type": "text",
            "label": "点击取消"
        }},
        {"action": "return", "params": {}},
        
        {"action": "label", "params": {"name": "点击确定"}},
        {"action": "click_text", "params": {"text": "确定"}},
        {"action": "return", "params": {}},
        
        {"action": "label", "params": {"name": "点击取消"}},
        {"action": "click_text", "params": {"text": "取消"}},
        {"action": "return", "params": {}}
    ]
}
```

---

## 常见问题

### Q: 坐标怎么获取？

1. 用软件截图
2. 用画图软件打开截图
3. 把鼠标移到目标位置，左下角会显示坐标

### Q: 图片匹配不到怎么办？

1. 降低 confidence 值（比如从0.8改成0.7）
2. 重新截取更清晰的图片
3. 确保图片没有被缩放
4. 检查图片路径是否正确

### Q: 文字识别不准怎么办？

1. 使用 region 参数限定搜索区域
2. 确保文字清晰、没有遮挡
3. 尝试只匹配部分文字（比如"确定按钮"只搜"确定"）

### Q: 脚本运行太快/太慢？

- 太快：在操作之间加 wait 指令
- 太慢：减少 wait 的时间

### Q: 如何停止脚本？

- 点击软件界面的"停止"按钮
- 或者把鼠标快速移到屏幕左上角（安全机制）

### Q: JSON格式错误怎么办？

常见错误：
- 忘记加逗号
- 多加了逗号（最后一项不需要逗号）
- 引号不匹配
- 括号不匹配

建议用在线JSON校验工具检查：https://jsonlint.com/

---

## 小技巧

1. **先写简单的，再逐步完善**
   - 先让脚本能跑起来
   - 再慢慢添加条件判断

2. **多用模块化**
   - 把重复的操作写成单独的模块
   - 用 call_script 调用

3. **合理使用等待**
   - 界面切换后要等待
   - 网络操作后要等待

4. **图片要截取关键部分**
   - 不要截太大，容易匹配失败
   - 不要截太小，容易误匹配
   - 选择有特征的部分

5. **善用条件跳转**
   - 让脚本能应对不同情况
   - 比如：有怪打怪，没怪走路

---

祝你使用愉快！如有问题，欢迎反馈。
